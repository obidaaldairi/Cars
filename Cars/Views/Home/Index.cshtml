@using Models
@model SearchModel
@{
    ViewData["Title"] = "Home Page";
}

<div class="container mt-5">
    @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
    {
        <div class="alert alert-danger alert-custom" role="alert">
            <i class="fas fa-exclamation-circle"></i> @ViewBag.ErrorMessage
        </div>
    }
    @* 
    @if (!string.IsNullOrEmpty(ViewBag.InfoMessage))
    {
        <div class="alert alert-info alert-custom" role="alert">
            <i class="fas fa-info-circle"></i> @ViewBag.InfoMessage
        </div>
    } *@
    <form asp-action="Search" method="post" id="searchForm">
        <div class="row">
            <div class="col-4">
                <label for="dropdown1" class="form-label">Car Makes</label>
                <select asp-for="MakeId" class="form-select" onchange="GetVehicleTypeByMakeId(this.value)">
                    <option value="" selected>Choose Makes...</option>
                    @foreach (var make in Model.Makes)
                    {
                        <option value="@make.Make_ID">@make.Make_Name</option>
                    }
                </select>
                <span asp-validation-for="MakeId" class="text-danger"></span>
            </div>


            <div class="col-4">
                <label class="form-label">Vehicle Type</label>
                <input type="text" id="vehicleTypeText" class="form-control" readonly placeholder="Select a make first">
                <input type="hidden" id="vehicleTypeId" name="VehicleTypeId">
            </div>

            <div class="col-4">
                <label for="dropdown1" class="form-label">Years</label>
                <select asp-for="YearID" class="form-select">
                    <option value="" selected>Choose Year...</option>
                    @foreach (var item in Model.Years)
                    {
                        <option value="@item">@item</option>
                    }
                </select>
                <span asp-validation-for="YearID" class="text-danger"></span>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <button type="submit" class="btn btn-primary">Apply Filters</button>
                @* <button type="button" class="btn btn-secondary ms-2">Reset</button> *@
            </div>
        </div>
    </form>
</div>
<script>
    function GetVehicleTypeByMakeId(makeId) {
        debugger;
        if (makeId === "")
        {
            $('#vehicleTypeText').val('Select a make first');
            $('#vehicleTypeId').val('');
            return;
        }

        $.ajax({
            url: '@Url.Action("GetVehicleTypeByMakeId", "Home")',
            type: 'GET',
            data: { makeId: makeId },
                success: function(data) {
        console.log(data);

        if (data && data.vehicleTypeId) {
            $('#vehicleTypeText').val(data.vehicleTypeName);
            $('#vehicleTypeId').val(data.vehicleTypeId);
        } else {
            $('#vehicleTypeText').val('No Vehicle Type Available');
            $('#vehicleTypeId').val('');
        }
    },
            error: function() {
                alert('Error retrieving data');
            }
        });
    }
</script>
@section Scripts {
    @{
        <partial name="_ValidationScriptsPartial" />
    }
}